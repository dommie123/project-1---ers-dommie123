<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1">
		<title>Revature ERS Home</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous" />
		<style type="text/css">
			header {
				float: right;
				color: gray;
				font-weight: bold;
			}
			#table-title {
				text-align: center;
				font-weight: bold;
				font-size: 14px;
				margin-bottom: 3em;
			}
			#reimbursements {
				margin: auto 5%;
				margin-top: 10px;
				width: 90%;
				
			}
			#add-reimbursement {
				background-color: #F06E2E;
			}
			#buttons {
				margin: 25px auto;
			}
		</style>
	</head>
	<body>
		<header class="header">
			<p id="welcome">Hello, user!</p>
		</header>
		<br />
		<div id="table-title"><h1>Expense Reimbursements</h1></div>
		<table class="table" id="reimbursements">
			<thead>
				<tr>
					<th scope="col">Reimbursement Id</th>
					<th scope="col">Type</th>
					<th scope="col">Amount</th>
					<th scope="col">Status</th>
					<th scope="col">Submitted</th>
					<th scope="col">Resolved</th>
				</tr>
			</thead>
			<!-- Here, JS will insert the reimbursements via a JSON file or some other method. -->
		</table>
		<div class="container" id="buttons">
			<div class="row">
				<div class="col-sm"><button class="btn btn-secondary" id="refresh" style="float: left;">Refresh List</button></div>
				<div class="col-sm" id="spacer" style="padding: inherit 5em;"><br /></div><!-- This is only here to create an empty space between both buttons -->
				<div class="col-sm"><button class="btn btn-primary" id="add-reimbursement" style="float: right;">Submit Reimbursement Claim</button></div>
			</div>
		</div>
		<script type="text/javascript">
			window.onload = getUser();	
			document.getElementById("refresh").addEventListener("click", refreshList);
			var clicked = false;
			
			function refreshList() {

			    let xhttp = new XMLHttpRequest();

			    xhttp.onreadystatechange = function() {
			        if (xhttp.readyState == 4 && xhttp.status == 200) {
			            let reimbJSON = JSON.parse(xhttp.responseText);
			            console.log(reimbJSON);
			            tableManip(reimbJSON);
			        }
			    }

			    xhttp.open("POST", "http://localhost:8080/project1/resources/html/reimb.json");

			    xhttp.send();
			}

			function tableManip(reimbJSON) {
			    let reimBody = document.createElement('tbody');
			    document.getElementById("reimbursements").appendChild(reimBody);

			    let size = 0;
			    if (!clicked) {
			    	clicked = true;
			    	for (let el of reimbJSON) {
			    		let row = document.createElement('tr');
			    		reimBody.appendChild(row);
			    		
			            let id = document.createElement('td');
			            id.innerText = reimbJSON[size].id;
			            let amount = document.createElement('td');
			            amount.innerText = reimbJSON[size].amount;
			            let submitted = document.createElement('td');
			            let subTime = Date.UTC(reimbJSON[size].submitted.hours, reimbJSON[size].submitted.minutes, reimbJSON[size].submitted.seconds);
			            submitted.innerText = reimbJSON[size].subTime;
			            let resolved = document.createElement('td');
			            let resTime = Date.UTC(reimbJSON[size].resolved.hours, reimbJSON[size].resolved.minutes, reimbJSON[size].resolved.seconds);
			            resolved.innerText = reimbJSON[size].resTime;
			            let description = document.createElement('td');
			            description.innerText = reimbJSON[size].description;
			            let receipt = document.createElement('td');
			            receipt.innerText = reimbJSON[size].receipt;
			            let author = document.createElement('td');
			            author.innerText = reimbJSON[size].author;
			            let resolver = document.createElement('td');
			            resolver.innerText = reimbJSON[size].resolver;
			            let status = document.createElement('td');
			            status.innerText = reimbJSON[size].status;
			            let type = document.createElement('td');
			            type.innerText = reimbJSON[size].type;

			        	row.appendChild(id);
			        	row.appendChild(type);
			        	row.appendChild(amount);
			        	row.appendChild(status);
			        	row.appendChild(submitted)
			        	row.appendChild(resolved)
			        	//row.appendChild(description);
			        	//row.appendChild(receipt);
			        	//row.appendChild(author);
			        	//row.appendChild(resolver);
			        	//row.appendChild(status);

			        	size++;			  
			    	}


			    	if (size <= 0) {
			        	let el = document.createElement('div');
			        	el.setAttribute('id', 'noreimb');
			        	el.style.marginLeft = "5%";
            			document.body.insertBefore(el, document.getElementById("buttons"));
            			
			    		let spacer = document.createElement('br');
			    		document.body.insertBefore(spacer, el);

			        	let message = document.createElement('th');
			        	message.style.color = "red";
			        	message.style.marginLeft = "2em";
			       		message.style.marginTop = "10px";
			        	message.innerText = "You don't have any reimbursement claims with us! Please create one to build your list!";
			        	el.appendChild(message);
			    	}
			    }
			}
			
			function getUser() {
				let xhttp = new XMLHttpRequest();
				
				xhttp.onreadystatechange = function() {
					if (xhttp.readyState == 4 && xhttp.status == 200) {
						let userJSON = JSON.parse(xhttp.responseText);
						console.log(userJSON);
						DOMManip(userJSON);
					}
				}
				
				xhttp.open("POST", 'http://localhost:8080/project1/resources/html/login.json');
				
				xhttp.send();
			}

			function DOMManip(uJSON) {
				document.getElementById("welcome").innerText = `Hello, ${uJSON.firstName}!`;
			}
		</script>
	</body>
</html>